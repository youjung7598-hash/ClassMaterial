
![[Pasted image 20250817122837.png]]

![[Pasted image 20250817123642.png]]

---
Grafanaë¥¼ í™œìš©í•˜ì—¬ ì‹¤ìŠµí•´ë³´ê¸°

ë©”íŠ¸ë¦­ ì´ë¦„ì„ í™•ì¸í•˜ë ¤ë©´
`http://localhost:8900/metrics`: django
`http://localhost:8000/metrics`: fast api

`django`
![[Pasted image 20250818113422.png]]

`fast api`
![[Pasted image 20250818085034.png]]
django ë©”íŠ¸ë¦­ ì´ë¦„ì€ `python_gc_objects_uncollectable_total` ì…ë‹ˆë‹¤.
fast api ë©”íŠ¸ë¦­ ì´ë¦„ì€ `fastapi_request_count_total` ì…ë‹ˆë‹¤.

---
`fastapi_request_count_total`(ìš”ì²­ ìˆ˜, ëˆ„ì  Counter) ì›ì‹œì¹´ìš´í„°
![[Pasted image 20250818102748.png]]
ë©”íŠ¸ë¦­ ì´ë¦„ì„ ë„£ìœ¼ë©´ ì›ì‹œê°’ì´ ë‚˜ì˜¤ë©° ì‚¬ì„ ìœ¼ë¡œ ì˜¬ë¼ê°€ëŠ” ê°’ì´ ë‚˜ì˜µë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ 
ìš”ì²­ìˆ˜/ì´ˆë‹¹ ì²˜ë¦¬ëŸ‰ì„ ì½ê¸°ì—” ë¶€ì í•© í•©ë‹ˆë‹¤.

---
### Grafanaì—ì„œ ì‹¤ìŠµí•´ë³´ê¸°
#### ì²«ë²ˆì§¸

ìš”ì²­/ì´ˆë‹¹ ì²˜ë¦¬ëŸ‰(RPS) ìœ¼ë¡œ ë³´ë ¤ë©´ `rate()`(RPS) ë˜ëŠ” `increase()`(ìµœê·¼ Në¶„ ë™ì•ˆ ê±´ìˆ˜)

1) RPS(ì´ˆë‹¹ ìš”ì²­ ìˆ˜) íŒ¨ë„ ë§Œë“¤ê¸° â€” ë‹¨ê³„ë³„
	 ëª©í‘œ: â€œìµœê·¼ 5ë¶„ ì°½ ê¸°ì¤€, ì´ˆë‹¹ ëª‡ ê±´ ì²˜ë¦¬ ì¤‘ì¸ê°€?â€
	 
2. ì¿¼ë¦¬ ì…ë ¥ì¹¸ì— **Builder** ëª¨ë“œì—ì„œ Metric:  
	
    `python_gc_objects_uncollectable_total`
    
3. **+ Operations â†’ Rate** ì„ íƒ, **Range = 5m**.
    
4. **Label filters**ì—ì„œ `endpoint != /metrics` ì¶”ê°€  
    (Prometheusê°€ ê¸ëŠ” íŠ¸ë˜í”½ ì œì™¸)
    
5. **+ Operations â†’ Aggregate â†’ Sum**
    - **group by ë¹„ìš°ê¸°** â†’ ì „ì²´ í•©ê³„ í•œ ì¤„
    - (ì›í•˜ë©´ `method, status_code`ë¡œ ê·¸ë£¹ â†’ ë¼ì¸ ë¶„ë¦¬)
        
6. ìš°ì¸¡ ì‚¬ì´ë“œë°” **Unit** â†’ `requests/sec (ops)`ë¡œ ë³€ê²½.  
    **Title**: `RPS (5m rate)`
    
7. ìƒë‹¨ **Last 15 minutes** ì •ë„ë¡œ ë‘ê³  **Run queries**.
    
ì‹¤ì œ íŠ¸ë˜í”½ ì¡°ê¸ˆ ë§Œë“¤ê¸°
ì´ ëª…ë ¹ì€ ë£¨íŠ¸ ê²½ë¡œ `/` ë¡œ 60ë²ˆ ì—°ì† GET ìš”ì²­ì„ ë³´ë‚´ì„œ ì˜ë„ì ìœ¼ë¡œ ì›¹ íŠ¸ë˜í”½(ìš”ì²­) ì„ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.
```bash
# django
for i in {1..60}; do curl -s -o /dev/null http://localhost:8900/; done

# ê´€ë¦¬ì ë¡œê·¸ì¸ í˜ì´ì§€ì— ë³´ë‚´ë„ ë¨
for i in {1..60}; do curl -s -o /dev/null http://localhost:8900/admin/login/; done

# fast api
for i in {1..60}; do curl -s -o /dev/null http://localhost:8000/; done
```

ì§ë ¬ ë£¨í”„ëŠ” ë„ˆë¬´ ë¹¨ë¦¬ ëë‚˜ì„œ 5ë¶„ í‰ê·  ë ˆì´íŠ¸ê°€ ê±°ì˜ 0ì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆì–´ìš”. ë™ì‹œ/ì§€ì†ìœ¼ë¡œ ì˜ë©´ í™•ì‹¤íˆ ë³´ì…ë‹ˆë‹¤.  ì¡°ê¸ˆ ë” â€œRPSê°€ ë³´ì´ëŠ”â€ íŠ¸ë˜í”½ (ë™ì‹œì„±)
```bash
# xargsë¡œ ë™ì‹œ 8ê°œ
seq 400 | xargs -n1 -P8 -I{} curl -s -o /dev/null http://localhost:8900/

# hey ì‚¬ìš©(ìˆë‹¤ë©´): 30ì´ˆ ë™ì•ˆ ë™ì‹œ 10
hey -z 30s -c 10 http://localhost:8900/

# ab ì‚¬ìš©(ìˆë‹¤ë©´)
ab -n 1000 -c 20 http://localhost:8900/
```

ì½”ë“œë¡œ ì“°ë©´: ì „ì²´ RPS (ì´ˆë‹¹ ì²˜ë¦¬ëŸ‰)
```
# django
sum( rate(django_http_responses_total_by_status_view_method_total{view!="prometheus-django-metrics"}[5m])
)

# fast api
sum(rate(python_gc_objects_uncollectable_total{endpoint!="/metrics"}[5m]))
```
- **ë¬´ì—‡?** ìµœê·¼ 5ë¶„ ì°½ì—ì„œì˜ ì´ˆë‹¹ í‰ê·  ìš”ì²­ ìˆ˜(RPS).
- **ë‹¨ìœ„:** requests/sec.
- **ë¼ì¸ ìˆ˜:** 1ê°œ(ì „ì²´ í•©ê³„).
- **ì–¸ì œ?** í˜„ì¬ ì²˜ë¦¬ëŸ‰ì„ í•œëˆˆì—(íŠ¸ë˜í”½ ë†’ê³  ë‚®ìŒ, ë¶€í•˜ ì¶”ì„¸).
- **íŠ¹ì§•:** `rate()`ëŠ” ì¹´ìš´í„° ì¦ê°€ ì†ë„ë¥¼ êµ¬í•´ì„œ ì¬ì‹œì‘/ë¦¬ì…‹ì„ ìë™ ë³´ì •.  
    ì•ˆì •ì (ì°½ì„ 5më¡œ ì¡ìœ¼ë©´ ìŠ¤íŒŒì´í¬ ì™„í™”).
---
ë©”ì„œë“œ/ìƒíƒœì½”ë“œë³„ RPS (ë¶„í•´ ë³´ê¸°):
```
# django
sum by (method, status) ( rate(django_http_responses_total_by_status_view_method_total{view!="prometheus-django-metrics"}[5m])
)

# fast api
sum by (method, status_code) (
  rate(fastapi_request_count_total{endpoint!="/metrics"}[5m])
)
```
- **ë¬´ì—‡?** ìœ„ì˜ RPSë¥¼ method, status_codeë¡œ ë‚˜ëˆ  ê°ê°ì˜ RPSë¥¼ êµ¬í•¨.
- **ë‹¨ìœ„:** requests/sec.
- **ë¼ì¸ ìˆ˜:** ì—¬ëŸ¬ ê°œ(GET-200, GET-500, POST-201 â€¦).
- **ì–¸ì œ?** â€œì–´ë–¤ ë©”ì„œë“œ/ìƒíƒœì½”ë“œì—ì„œ íŠ¸ë˜í”½ì´ ë‚˜ì˜¤ëŠ”ì§€â€ ë˜ëŠ” â€œì—ëŸ¬ RPSê°€ ëŠ˜ì—ˆëŠ”ì§€â€ë¥¼ ë³´ê³  ì‹¶ì„ ë•Œ.
- **íŠ¹ì§•:** í•©ê³„ê°€ í•„ìš”í•˜ë©´ ì²« ì¿¼ë¦¬, ë¶„ì„/ë””ë²„ê¹…ì´ë©´ ì´ ì¿¼ë¦¬.
---
ìµœê·¼ Në¶„ ì´ ê±´ìˆ˜ (ë³¼ë¥¨):
```
# django
sum(
increase(django_http_responses_total_by_status_view_method_total{view!="prometheus-django-metrics"}[5m])
)

# fast api
sum(increase(fastapi_request_count_total{endpoint!="/metrics"}[5m]))
```
- **ë¬´ì—‡?** ìµœê·¼ 5ë¶„ ë™ì•ˆ ë“¤ì–´ì˜¨ ìš”ì²­ì˜ ëˆ„ì  ê±´ìˆ˜(í•©ê³„).
- **ë‹¨ìœ„:** requests(ê±´).
- **ë¼ì¸ ìˆ˜:** 1ê°œ(ì „ì²´ í•©ê³„).
- **ì–¸ì œ?** ê¸°ê°„ë³„ ë³¼ë¥¨ì´ ê¶ê¸ˆí•  ë•Œ(â€œì§€ë‚œ 5ë¶„ì— ëª‡ ê±´ì´ë‚˜ ì™”ì§€?â€ â€œì§€ë‚œ 1ì‹œê°„ ì´ ëª‡ ê±´?â€).
- **íŠ¹ì§•:** `increase()`ëŠ” ì°½ ê¸°ê°„ ë‚´ í•©ê³„ë¥¼ ì§ì ‘ ì¤Œ.  
    ëŒ€ëµ `increase â‰ˆ rate Ã— ì°½ì´ˆ(ì´ˆ)` ê´€ê³„ê°€ ìˆìŒ (ì˜ˆ: RPS 0.4ë©´ 5ë¶„ ê±´ìˆ˜ â‰ˆ 0.4Ã—300=120).

###### í•œëˆˆì— ë¹„êµ
| ì¿¼ë¦¬                                           | ë³´ì—¬ì£¼ëŠ” ê²ƒ       | ë‹¨ìœ„    | ë¼ì¸ ìˆ˜        . | ì“°ì„ìƒˆ                   |
| -------------------------------------------- | ------------ | ----- | ------------: | --------------------- |
| `sum(rate(...[5m]))`                         | ì „ì²´ ì²˜ë¦¬ëŸ‰(RPS)  | req/s |             1 | í˜„ì¬ ë¶€í•˜/íŠ¸ë˜í”½ ì¶”ì„¸          |
| `sum by (method,status_code)(rate(...[5m]))` | ë¶„í•´ëœ ì²˜ë¦¬ëŸ‰(RPS) | req/s |            ì—¬ëŸ¬ | ì–´ë–¤ ë©”ì„œë“œ/ìƒíƒœê°€ ê¸°ì—¬/ë¬¸ì œì¸ì§€ ë¶„ì„ |
| `sum(increase(...[5m]))`                     | ìµœê·¼ 5ë¶„ ì´ ê±´ìˆ˜   | req   |             1 | ë³¼ë¥¨(ëª‡ ê±´ì´ë‚˜ ì™”ë‚˜), ë¦¬í¬íŒ…/ì§‘ê³„  |

---
###### í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ MonitoringíŒŒíŠ¸ì— ë„£ì„ë¶€ë¶„ (1)
íŒ¨ë„ 3ì¢… ìŠ¤ìƒ· + ì¿¼ë¦¬ + ì–´ë–»ê²Œ ì½ê³  ëŒ€ì‘í–ˆëŠ”ì§€ê¹Œì§€ í•œ í™”ë©´ì˜ ì´ì•¼ê¸°ë¡œ ë§Œë“¤ê¸°

---
#### ë‘ë²ˆì§¸

ì‘ë‹µ ì§€ì—°ì‹œê°„(Latency)
íŠ¹íˆ p95(95ë²ˆì§¸ í¼ì„¼íƒ€ì¼) ì„ ê¸°ë³¸ìœ¼ë¡œ ë³´ë©´ â€œëŒ€ë¶€ë¶„ì˜ ì‚¬ìš©ì ì²´ê° ì†ë„â€ë¥¼ ì¡ì•„ë‚¼ ìˆ˜ ìˆì–´ìš”.

ì™œ p95ì¸ê°€?
- í‰ê· ì€ ì†Œìˆ˜ì˜ ëŠë¦° ìš”ì²­ì— ëœ ë¯¼ê°í•˜ê±°ë‚˜, ë°˜ëŒ€ë¡œ ëª‡ ë²ˆì˜ ê¸‰ë“±ì— ëŒë ¤ë‹¤ë…€ìš”.
- **p95/p99**ëŠ” â€œê¼¬ë¦¬ ì§€ì—°(tail latency)â€ë¥¼ ë³´ì—¬ì¤˜ì„œ ì²´ê° í’ˆì§ˆê³¼ ì„±ëŠ¥ ì´ìŠˆë¥¼ ë¹¨ë¦¬ ë°œê²¬í•©ë‹ˆë‹¤.

ì²´í¬í•´ì•¼í•  ì‚¬í•­ì€?
- ì „ì²´ p95 ì§€ì—°ì‹œê°„
- ì—”ë“œí¬ì¸íŠ¸ë³„ p95(ì–´ë””ê°€ ëŠë¦°ì§€)
- (ì„ íƒ) í‰ê·  ì§€ì—°ì‹œê°„ë„ í•¨ê»˜

**íˆìŠ¤í† ê·¸ë¨** ë©”íŠ¸ë¦­ ì°¾ê¸° 

`django_db_query_duration_seconds_bucket`
![[Pasted image 20250818114721.png]]

`fastapi_request_latency_seconds_bucket` (ë¼ë²¨: `endpoint`)
![[Pasted image 20250818112847.png]]

íŒ¨ë„ A: ì „ì²´ p95 ì§€ì—°ì‹œê°„ (5m ì°½)
```
# django
histogram_quantile(
  0.95,
  sum by (le) (  rate(django_http_requests_latency_seconds_by_view_method_bucket{view!="prometheus-django-metrics"}[5m])
  )
)

# fast api
histogram_quantile(
  0.95,
  sum by (le) (
rate(fastapi_request_latency_seconds_bucket{endpoint!="/metrics"}[5m])
  )
)
```
Grafana ì„¤ì •
- Unit: `seconds` (ë˜ëŠ” ì¿¼ë¦¬ ëì— `* 1000` â†’ Unit `milliseconds`)
- Title: `Latency p95 (5m)`
- Thresholds ì˜ˆ: 0.8s ê²½ê³ , 1.5s ì‹¬ê°

---
íŒ¨ë„ B: ì—”ë“œí¬ì¸íŠ¸ë³„ p95 (ì–´ë””ê°€ ëŠë¦°ì§€)
```
# django
histogram_quantile(
  0.95,
  sum by (view, le) (rate(django_http_requests_latency_seconds_by_view_method_bucket{view!="prometheus-django-metrics"}[5m])
  )
)

# fast api
histogram_quantile(
  0.95,
  sum by (endpoint, le) (
 rate(fastapi_request_latency_seconds_bucket{endpoint!="/metrics"}[5m])
  )
)
```
ì—¬ëŸ¬ ë¼ì¸ìœ¼ë¡œ í‘œì‹œë˜ì–´ **ë³‘ëª© ì—”ë“œí¬ì¸íŠ¸**ê°€ ë“œëŸ¬ë‚©ë‹ˆë‹¤.

---
í‰ê·  ì§€ì—°ì‹œê°„
```
# django
sum(rate(django_http_requests_latency_seconds_by_view_method_sum{view!="prometheus-django-metrics"}[5m]))
/
sum(rate(django_http_requests_latency_seconds_by_view_method_count{view!="prometheus-django-metrics"}[5m]))


# fast api
sum(rate(fastapi_request_latency_seconds_sum{endpoint!="/metrics"}[5m]))
/
sum(rate(fastapi_request_latency_seconds_count{endpoint!="/metrics"}[5m]))
```
- Unit: `seconds`
- í‰ê· ì€ ì°¸ê³ ìš©(íŠœë‹ ê²°ê³¼ ë¹„êµ ë“±), ë³¸ ê´€ì œëŠ” p95 ê¶Œì¥.

---
###### í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ MonitoringíŒŒíŠ¸ì— ë„£ì„ë¶€ë¶„ (2)

---
#### ì„¸ë²ˆì§¸

5xx (ì„œë²„ ì˜¤ë¥˜)
- **ì˜ë¯¸**: HTTP ìƒíƒœ ì½”ë“œ ì¤‘ 500ë²ˆëŒ€ â†’ ì„œë²„/ë°±ì—”ë“œì—ì„œ ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ë‚˜ì˜¤ëŠ” ì‘ë‹µì´ì—ìš”.
    - `500` Internal Server Error
    - `502` Bad Gateway
    - `503` Service Unavailable
    - `504` Gateway Timeout â€¦
        
- **íŠ¹ì§•**: í´ë¼ì´ì–¸íŠ¸(ì‚¬ìš©ì) ì˜ëª»ì´ ì•„ë‹ˆë¼ ì„œë²„ ì±…ì„ì´ì—ìš”.

SLO (Service Level Objective)
- **ì •ì˜**: ì„œë¹„ìŠ¤ê°€ ì–´ëŠ ì •ë„ í’ˆì§ˆì„ ìœ ì§€í•´ì•¼ í•˜ëŠ”ì§€ ëª©í‘œì¹˜.
- ì˜ˆì‹œ:
    - "ì˜¤ë¥˜ìœ¨ì€ 1% ë¯¸ë§Œì´ì–´ì•¼ í•œë‹¤"
    - "ì‘ë‹µ ì†ë„ì˜ 95%ê°€ 200ms ì´ë‚´ì—¬ì•¼ í•œë‹¤"
- ì¦‰, ì„œë¹„ìŠ¤ê°€ ì§€ì¼œì•¼ í•  ì•½ì† ê°™ì€ ê¸°ì¤€ì´ì—ìš”.

ì˜¤ë¥˜ìœ¨ ëª¨ë‹ˆí„°ë§
- ë³´í†µì€ `5xx ì‘ë‹µ ê°œìˆ˜ Ã· ì „ì²´ ìš”ì²­ ê°œìˆ˜` = ì˜¤ë¥˜ìœ¨ë¡œ ê³„ì‚°í•´ìš”.
- ì˜ˆì‹œ:
    - 1ë¶„ ë™ì•ˆ ìš”ì²­ 1000ê±´ ì¤‘ 5xxê°€ 3ê±´ â†’ ì˜¤ë¥˜ìœ¨ 0.3%
    - SLOê°€ "1% ë¯¸ë§Œ"ì´ë¼ë©´ â†’ OK
    - ë§Œì•½ 20ê±´ì´ë¼ë©´ 2% â†’ SLO ìœ„ë°˜ ğŸš¨

íŠ¸ë˜í”½ì´ ì ì„ ë•Œ ë¬¸ì œ
- ìš”ì²­ì´ ê±°ì˜ ì—†ì„ ë•ŒëŠ” ë¹„ìœ¨ë§Œ ë³´ë©´ ì´ìƒí•˜ê²Œ ë³´ì—¬ìš”.
    - ì˜ˆ: ìš”ì²­ 5ê±´ ì¤‘ 1ê±´ì´ ì‹¤íŒ¨ â†’ ì˜¤ë¥˜ìœ¨ 20% (í¬ê²Œ ë³´ì„)
- ì‹¤ì œë¡œëŠ” 1ê±´ë°–ì— ì•ˆ ì‹¤íŒ¨í–ˆëŠ”ë° ì‹¬ê°í•´ ë³´ì´ëŠ” ê±°ì£ .

ê·¸ë˜ì„œ ê°™ì´ ë³´ëŠ” ì§€í‘œ
1. ì˜¤ë¥˜ìœ¨ (ë¹„ìœ¨): í’ˆì§ˆ ê¸°ì¤€ ì¶©ì¡± ì—¬ë¶€ í™•ì¸ (SLO ì¤€ìˆ˜ í™•ì¸ìš©)
2. 5xx ì ˆëŒ€ê°’ (RPS, ì´ˆë‹¹ ì‹¤íŒ¨ ê±´ìˆ˜): ì‹¤ì œë¡œ ëª‡ ê±´ì´ë‚˜ ì‹¤íŒ¨í•˜ëŠ”ì§€ ê°ì§€ (íŠ¸ë˜í”½ ì ì„ ë•Œ ìš”ë™ ë°©ì§€)
---
- 5xxëŠ” ì„œë²„/ë°±ì—”ë“œ ì±…ì„ ì˜¤ë¥˜. SLO(ì˜ˆ: ì˜¤ë¥˜ìœ¨ < 1%)ë¥¼ ë°”ë¡œ í™•ì¸Â·ì•Œë¦¼, ì¥ì•  ì „ì¡° íƒì§€ì— í•„ìˆ˜.
- íŠ¸ë˜í”½ì´ ì ì„ ë• ë¹„ìœ¨ë§Œ ë³´ë©´ ìš”ë™ì¹˜ë¯€ë¡œ, ì ˆëŒ€ê°’(5xx RPS) íŒ¨ë„ë„ ê°™ì´ ë‘ëŠ” ê±¸ ì¶”ì²œ.
---
FastAPI 
(ë©”íŠ¸ë¦­: `fastapi_request_count_total{endpoint,method,status_code}`)
ì „ì²´ 5xx ì—ëŸ¬ìœ¨(%) â€” ìµœê·¼ 5ë¶„ ì°½
```
100 *
(
  sum(rate(fastapi_request_count_total{status_code=~"5..", endpoint!="/metrics"}[5m])) 
  or vector(0)
)
/
clamp_min(
  sum(rate(fastapi_request_count_total{endpoint!="/metrics"}[5m])),
  1
)
```
- **ë‹¨ìœ„**: Percent(0-100) ë¡œ ì„¤ì •.
- `/metrics` ì œì™¸: Prometheus ìŠ¤í¬ë© íŠ¸ë˜í”½ ì œê±°.
- `or vector(0)`, `clamp_min(...,1)`: ë¶„ëª¨ 0/ë°ì´í„° ì—†ìŒ ì‹œ NaN ë°©ì§€.

ì—”ë“œí¬ì¸íŠ¸ë³„ 5xx ì—ëŸ¬ìœ¨(%) â€” ì–´ë””ê°€ ë¬¸ì œ?
```
100 *
(
  sum by (endpoint) (rate(fastapi_request_count_total{status_code=~"5..", endpoint!="/metrics"}[5m]))
  or vector(0)
)
/
clamp_min(
  sum by (endpoint) (rate(fastapi_request_count_total{endpoint!="/metrics"}[5m])),
  1
)
```
- **Legend**: `{{endpoint}}`
- **Transformations**(ì„ íƒ): _Sort desc_ â†’ _Limit_ ìœ¼ë¡œ Top Në§Œ í‘œì‹œ.

5xx ì ˆëŒ€ëŸ‰(RPS) â€” ë¹„ìœ¨ ë³´ì¡°ì§€í‘œ
```
sum(rate(fastapi_request_count_total{status_code=~"5..", endpoint!="/metrics"}[5m]))
```
- **Unit**: requests/sec(ops).
- ë¹„ìœ¨ì´ ë‚®ì•„ë„ ì ˆëŒ€ 5xxê°€ ë§ì€ ê²½ìš°ë¥¼ ìºì¹˜.

---
Django (`django-prometheus` ê¸°ë³¸ ë©”íŠ¸ë¦­ ì‚¬ìš©)
ì „ì²´ 5xx ì—ëŸ¬ìœ¨(%) â€” ìµœê·¼ 5ë¶„ ì°½
```
100 *
(
  sum(rate(django_http_responses_total_by_status_total{status=~"5.."}[5m]))
  or vector(0)
)
/
clamp_min(
  sum(rate(django_http_responses_total_by_status_total[5m])),
  1
)
```
**Unit**: Percent(0-100).

ë·°(ì—”ë“œí¬ì¸íŠ¸)ë³„ 5xx ì—ëŸ¬ìœ¨(%)
```
100 *
(
  sum by (view) (rate(django_http_responses_total_by_status_view_method_total{status=~"5..", view!="prometheus-django-metrics"}[5m]))
  or vector(0)
)
/
clamp_min(
  sum by (view) (rate(django_http_responses_total_by_status_view_method_total{view!="prometheus-django-metrics"}[5m])),
  1
)
```
- **Legend**: `{{view}}` (ì›í•˜ë©´ `{{view}} - {{method}}`)
- `/metrics` ë·° ì œì™¸: `view!="prometheus-django-metrics"`

5xx ì ˆëŒ€ëŸ‰(RPS)
```
sum(rate(django_http_responses_total_by_status_total{status=~"5.."}[5m]))
```
**Unit**: requests/sec(ops).

---
Grafana íŒ¨ë„ ì„¤ì •(ê³µí†µ)
- **Unit**
    - ì—ëŸ¬ìœ¨ íŒ¨ë„: `Percent (0â€“100)`
    - 5xx RPS íŒ¨ë„: `requests/sec (ops)`
- **Time range**: `Last 15 minutes` ì •ë„ ê¶Œì¥.
- **Thresholds**(ì˜ˆì‹œ)
    - ì—ëŸ¬ìœ¨: 1% = ê²½ê³ , 5% = ì‹¬ê°
- **Legend**
    - ì „ì²´ ì—ëŸ¬ìœ¨: `5xx error rate (%)`
    - ì—”ë“œí¬ì¸íŠ¸ë³„: `{{endpoint}} 5xx%` / `{{view}} 5xx%`
- **No dataì¼ ë•Œ**
    - ìµœê·¼ íŠ¸ë˜í”½ì´ ì—†ìœ¼ë©´ 0 ê·¼ì²˜ê±°ë‚˜ ë¹ˆ ê·¸ë˜í”„. í…ŒìŠ¤íŠ¸ ìš”ì²­ì„ ëª‡ ë²ˆ ë³´ë‚´ì„œ í™•ì¸.

---
ë°ì´í„°ê°€ ì§„ì§œ ë³´ì´ëŠ”ì§€ í…ŒìŠ¤íŠ¸
(A) íŠ¸ë˜í”½ ì¡°ê¸ˆ ë°œìƒì‹œí‚¤ê¸° : í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰
```bash
# FastAPI ë£¨íŠ¸(ë˜ëŠ” ì„ì˜ ì—”ë“œí¬ì¸íŠ¸) 30ë²ˆ í˜¸ì¶œ
for i in {1..30}; do curl -s -o /dev/null http://localhost:8000/; done

# Django(admin ë¡œê·¸ì¸ í˜ì´ì§€ ë“±) 10ë²ˆ í˜¸ì¶œ
for i in {1..10}; do curl -s -o /dev/null http://localhost:8900/admin/login/; done
```
- ìœˆë„ìš° ì¡°ì •: `[1m]`(ë¯¼ê°) â†” `[5m]`(ì ë‹¹) â†” `[10m]`(ë¶€ë“œëŸ¬ì›€)
- /metrics ì œì™¸: `{endpoint!="/metrics"}`ë¥¼ ìŠµê´€ì²˜ëŸ¼ ì‚¬ìš©
---
ìì£¼ ì“°ëŠ” í‘œê¸°ë“¤
- RPS = Requests Per Second (ì´ˆë‹¹ ìš”ì²­ ìˆ˜)
- RPM = Requests Per Minute (ë¶„ë‹¹ ìš”ì²­ ìˆ˜)
- QPS = Queries Per Second (ì£¼ë¡œ DB/ê²€ìƒ‰ ì¿¼ë¦¬)
- TPS = Transactions Per Second (íŠ¸ëœì­ì…˜)
---
1. ì´ RPS(ì´ˆë‹¹ ìš”ì²­ ìˆ˜) ê°’ì´ ì˜¬ë¼ê°€ë©´ â€˜ìš”ì²­ ìˆ˜(íŠ¸ë˜í”½)â€™ê°€ ì¦ê°€í–ˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.
```
sum(rate(fastapi_request_count_total{endpoint!="/metrics"}[5m]))
```

![[Pasted image 20250817191126.png]]
â€œìµœê·¼ 5ë¶„ ë™ì•ˆ í‰ê· ì ìœ¼ë¡œ ì´ˆë‹¹ ëª‡ ê±´ ì²˜ë¦¬í–ˆë‚˜â€ ë¥¼ ëœ»í•´ìš”
ê·¸ë˜í”„ í•´ì„ (í™”ë©´ ê¸°ì¤€)
- ì™¼ìª½ êµ¬ê°„ì˜ 0.88~0.9: ìµœê·¼ 5ë¶„ ì°½ì—ì„œ í‰ê·  ì•½ 0.9 req/s ì²˜ë¦¬.  
    â†’ ë¶„ë‹¹ìœ¼ë¡œëŠ” 0.9 Ã— 60 = ì•½ 54 req/min.(`req`ëŠ” request(ë¦¬í€˜ìŠ¤íŠ¸, â€œìš”ì²­â€)ì˜ ì¤„ì„ë§ì´ì—ìš”.)
- 19:00 ê·¼ì²˜ì— ê³„ë‹¨í˜• í•˜ë½ â†’ 0: íŠ¸ë˜í”½ì„ ë©ˆì¶”ì, 5ë¶„ ì´ë™ì°½ì—ì„œ ê³¼ê±° ìš”ì²­ì´ ì ì  ë¹ ì ¸ë‚˜ê°€ë©° ê°’ì´ 0ìœ¼ë¡œ ê°ì‡ .
- 19:09~19:13ì— 0.35~0.4 ë¶€ê·¼: ê·¸ êµ¬ê°„ì—” í‰ê·  ì•½ 0.35~0.4 req/s(ë¶„ë‹¹ 21~24ê±´) ì •ë„ íŠ¸ë˜í”½ì´ ìˆì—ˆë‹¤ëŠ” ëœ».
- ë‹¤ì‹œ 0ìœ¼ë¡œ í•˜ë½: ê·¸ ë’¤ 5ë¶„ ì°½ì— ë‚¨ì€ ìš”ì²­ì´ ì—†ì–´ì§€ë©´ì„œ 0ìœ¼ë¡œ ë–¨ì–´ì§.
    
> í¬ì¸íŠ¸: `rate(...[5m])`ëŠ” ì´ ì‹œê° ê¸°ì¤€ ì§ì „ 5ë¶„ì„ ë´…ë‹ˆë‹¤(ìŠ¬ë¼ì´ë”© ì°½).  
> ê·¸ë˜ì„œ íŠ¸ë˜í”½ì„ ê°‘ìê¸° ë©ˆì¶°ë„ ì¦‰ì‹œ 0ì´ ì•„ë‹ˆë¼ â€œì„œì„œíˆâ€ 0ìœ¼ë¡œ ë‚´ë ¤ì™€ìš”.
---

0.4 req/sëŠ”  
â†’ â€œì´ˆë‹¹ 0.4ê±´ì˜ ìš”ì²­â€ = 0.4 requests per second ë¼ê³  ì½ìŠµë‹ˆë‹¤.  
ëŒ€ì¶© ë¶„ë‹¹ìœ¼ë¡œëŠ” `0.4 Ã— 60 = ì•½ 24ê±´/min`ì´ì—ìš”.

---
2. ë©”ì„œë“œ/ìƒíƒœë³„ RPS
```
sum by (method, status_code)(
  rate(fastapi_request_count_total{endpoint!="/metrics"}[5m])
)
```

![[Pasted image 20250817192450.png]]
ì´ ì¿¼ë¦¬ê°€ ëœ»í•˜ëŠ” ê²ƒ
- **`fastapi_request_count_total`**: ìš”ì²­ â€œëˆ„ì (ì¹´ìš´í„°)â€ ë©”íŠ¸ë¦­.
- **`rate(...[5m])`**: â€œìµœê·¼ 5ë¶„ ë™ì•ˆ ì´ˆë‹¹ ëª‡ ê±´ ì¦ê°€í–ˆëŠ”ê°€â€ â†’ RPS(requests/sec).
- **`sum by (method, status_code)`**: ë‚˜ë¨¸ì§€ ë¼ë²¨(ì˜ˆ: endpoint, instance)ì„ í•©ê³„í•˜ê³ ,  `method`Â·`status_code` ì¡°í•©ë³„ë¡œ í•œ ì¤„ì”© ë³´ì—¬ì¤ë‹ˆë‹¤.
- **`{endpoint!="/metrics"}`**: Prometheusê°€ ê¸ëŠ” `/metrics` í˜¸ì¶œì€ ì œì™¸.
    
ê·¸ë˜í”„ë¥¼ ì½ëŠ” ë°©ë²• (í™”ë©´ ê¸°ì¤€)
- Yì¶•: RPS(ì´ˆë‹¹ ìš”ì²­ ìˆ˜). `0.35`ë¼ë©´ 0.35 req/s â‰ˆ ë¶„ë‹¹ 21ê±´.
- ë²”ë¡€: `(method="GET", status_code="200")` â†’ â€œì„±ê³µí•œ GET ìš”ì²­â€ ë¼ì¸ í•˜ë‚˜ë¥¼ ë³´ê³  ìˆë‹¤ëŠ” ëœ».
- ì™¼ìª½ì˜ 0.88 ê·¼ì²˜ í‰ì§€: ìµœê·¼ 5ë¶„ ì°½ í‰ê· ìœ¼ë¡œ **ì•½ 0.88 req/s** ì²˜ë¦¬.
- 19:00 ê·¼ì²˜ì˜ ê³„ë‹¨í˜• í•˜ë½ â†’ 0: íŠ¸ë˜í”½ì„ ë©ˆì¶”ì, 5ë¶„ ì´ë™ì°½ì—ì„œ ê³¼ê±° ìƒ˜í”Œì´ ë¹ ì§€ë©° ê°’ì´ ì„œì„œíˆ 0ìœ¼ë¡œ.
- 19:09~19:13ì˜ 0.35 ì•ˆíŒ í‰ì§€: ê·¸ë•ŒëŠ” í‰ê·  **0.35 req/s** ì •ë„ì˜ íŠ¸ë˜í”½ì´ ìˆì—ˆë‹¤ëŠ” ëœ».
- ë‹¤ì‹œ 0: ìµœê·¼ 5ë¶„ì— í•´ë‹¹ ìš”ì²­ì´ ì—†ë‹¤ëŠ” ëœ».
    
> í¬ì¸íŠ¸: `rate([5m])`ëŠ” â€œì§€ê¸ˆ ì‹œê° ê¸°ì¤€ ì§ì „ 5ë¶„â€ì„ ë³´ëŠ” ì´ë™ì°½ì´ë¼ ê°‘ìê¸° ë©ˆì¶°ë„ ê°’ì´ ë¶€ë“œëŸ½ê²Œ ê°ì‡ í•©ë‹ˆë‹¤.

ì´ íŒ¨ë„ë¡œ ì•Œ ìˆ˜ ìˆëŠ” ê²ƒ / ì•Œ ìˆ˜ ì—†ëŠ” ê²ƒ
- ì•Œ ìˆ˜ ìˆìŒ: â€œì„±ê³µí•œ GET ìš”ì²­ì´ ì‹œê°„ëŒ€ë³„ë¡œ ì–¼ë§ˆë‚˜ ë“¤ì–´ì™”ë‚˜(RPS ì¶”ì´)â€
- ì•Œ ìˆ˜ ì—†ìŒ: ì§€ì—°ì‹œê°„, ì—ëŸ¬ìœ¨. â†’ ë³„ë„ íŒ¨ë„ë¡œ ë´ì•¼ í•¨.

---
3. p95 ì§€ì—°ì‹œê°„(ì´ˆ)
```
histogram_quantile(
  0.95,
  sum by (le) (rate(fastapi_request_latency_seconds_bucket[5m]))
)
```

![[Pasted image 20250817193128.png]]
- **`fastapi_request_latency_seconds_bucket`**: ì‘ë‹µ ì§€ì—°ì‹œê°„ íˆìŠ¤í† ê·¸ë¨ ë²„í‚·(ì´ˆ).
- **`rate(...[5m])`**: ìµœê·¼ **5ë¶„** ë™ì•ˆ ë²„í‚·ë³„ ì¦ê°€ëŸ‰/ì´ˆ(ìŠ¬ë¼ì´ë”© ìœˆë„ìš°).
- **`sum by (le)`**: ëª¨ë“  ë¼ë²¨(ì—”ë“œí¬ì¸íŠ¸/ë©”ì„œë“œ/ì¸ìŠ¤í„´ìŠ¤ ë“±)ì„ í•©ì³ì„œ ë²„í‚· ê²½ê³„(`le`)ë§Œ ë‚¨ê¹€ â†’ â€œì„œë¹„ìŠ¤ ì „ì²´ ë¶„í¬â€.
- **`histogram_quantile(0.95, â€¦)`**: ê·¸ ë¶„í¬ì—ì„œ p95(95ë²ˆì§¸ í¼ì„¼íƒ€ì¼) ì¶”ì •

ê·¸ë˜í”„ë¥¼ ì½ëŠ” ë°©ë²• (í™”ë©´ ê¸°ì¤€)
- Yì¶• ë‹¨ìœ„: ì´ˆ(s).  
    ê·¸ë˜í”„ê°€ 0.27ì— ìˆìœ¼ë©´ â€œìµœê·¼ 5ë¶„ ë™ì•ˆì˜ ìš”ì²­ ì¤‘ 95%ê°€ **0.27ì´ˆ(=270ms)** ì´ë‚´ì— ëë‚¬ë‹¤â€ëŠ” ëœ»ì´ì—ìš”.
- ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ì ê¹ ì†Ÿì€ ë´‰ìš°ë¦¬ëŠ” ê·¸ ì‹œì ì— ëŠë¦° ìš”ì²­(ì˜ˆ: `/slow`)ì´ ì„ì—¬ tailì´ ëŠ˜ì—ˆë‹¤ëŠ” ì‹ í˜¸.
    
- ê°’ì´ 0 ê·¼ì²˜ë¡œ í‰í‰í•˜ë©´:
    - ìµœê·¼ 5ë¶„ ë™ì•ˆ ìš”ì²­ì´ ê±°ì˜ ì—†ê±°ë‚˜(rateê°€ 0),
    - ëª¨ë‘ ë§¤ìš° ë¹¨ëê±°ë‚˜,
    - í…ŒìŠ¤íŠ¸ë¥¼ `/metrics`ë§Œ ë•Œë¦° ê²½ìš°ì¼ ìˆ˜ ìˆì–´ìš”.

ë‹¨ìœ„ë¥¼ msë¡œ: ì‹ ëì— `* 1000` ë¶™ì´ê³  Panel Unitì„ `milliseconds`ë¡œ.
```
1000 *
histogram_quantile(0.95, sum by (le) (rate(fastapi_request_latency_seconds_bucket[5m])))
```

ì—”ë“œí¬ì¸íŠ¸ë³„ p95:
```
histogram_quantile(
  0.95,
  sum by (le, endpoint) (
    rate(fastapi_request_latency_seconds_bucket{endpoint!="/metrics"}[5m])
  )
)
```
- â†’ ëŠë¦° ë¼ì¸ì´ ì–´ëŠ ê²½ë¡œì¸ì§€ ë°”ë¡œ ë³´ì…ë‹ˆë‹¤.
- p50 / p99ë„ ë™ì¼: `0.50`, `0.99`ë¡œ ë°”ê¾¸ê¸°ë§Œ í•˜ë©´ ë¼ìš”.
- SLO ì„  ê·¸ë¦¬ê¸°: Panel â†’ Thresholdsì— ì˜ˆ) 800ms(0.8s) ì¶”ê°€.

---
4. 5xx ì—ëŸ¬ìœ¨(%) 
```
100 *
( sum(rate(fastapi_request_count_total{endpoint!="/metrics", status_code=~"5.."}[5m])) or vector(0) )
/
clamp_min(
  sum(rate(fastapi_request_count_total{endpoint!="/metrics"}[5m])),
  1
)
```

![[Pasted image 20250817194132.png]]
- ìµœê·¼ 5ë¶„ ë™ì•ˆì˜ ì „ì²´ ìš”ì²­(RPS) ëŒ€ë¹„ 5xx ìš”ì²­(RPS) ì˜ ë°±ë¶„ìœ¨ì…ë‹ˆë‹¤.
- ê·¸ë˜í”„ê°€ 0% ê·¼ì²˜ì— ë¶™ì–´ìˆë‹¤ â†’ ìµœê·¼ 5ë¶„ ë™ì•ˆ 5xxê°€ ì—†ì—ˆê±°ë‚˜ ë§¤ìš° ë“œë¬¼ì—ˆë‹¤ëŠ” ëœ».
- 
ì¿¼ë¦¬ ê° ë¶€ë¶„ ëœ»
- `rate(...[5m])` : ì§ì „ 5ë¶„ ì°½ì—ì„œ ì´ˆë‹¹ ì¦ê°€ëŸ‰(=RPS).
- `status_code=~"5.."` : 500â€“599 ì„œë²„ ì˜¤ë¥˜ë§Œ ì§‘ê³„.
- `endpoint!="/metrics"` : Prometheusì˜ ìŠ¤í¬ë© ìš”ì²­ì€ ì œì™¸.
- `sum(...)` : ì¸ìŠ¤í„´ìŠ¤/ì—”ë“œí¬ì¸íŠ¸ ë“± ë¼ë²¨ì„ ëª¨ë‘ í•©ê³„.
- `or vector(0)` : 5xxê°€ ì „í˜€ ì—†ì„ ë•Œë„ ê°’ì´ ë¹ˆ ë²¡í„°ê°€ ì•„ë‹ˆë¼ 0ì´ ë˜ë„ë¡.
- `clamp_min(..., 1)` : ë¶„ëª¨(RPS í•©ê³„)ê°€ 0ì¼ ë•Œ 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ë°©ì§€(ì—ëŸ¬ìœ¨ì„ 0%ë¡œ ì²˜ë¦¬).
- ë§¨ ì•ì˜ `100 *` : ë¹„ìœ¨ â†’ í¼ì„¼íŠ¸(%) ë¡œ ë³€í™˜.

ê·¸ë˜í”„ë¥¼ ì½ëŠ” ë°©ë²• (í™”ë©´ ê¸°ì¤€)
- Yì¶• ë‹¨ìœ„: `%` ë¡œ ì„¤ì •í•˜ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤(Panel â†’ Unit â†’ _percent (0â€“100)_).
- ê°’ì´ 0%ì— ë¶™ì–´ ìˆìœ¼ë©´:
    - (a) ìµœê·¼ 5ë¶„ ë™ì•ˆ 5xxê°€ ì—†ìŒ, ë˜ëŠ”
    - (b) ìµœê·¼ 5ë¶„ ë™ì•ˆ ì „ì²´ RPSê°€ 0 (íŠ¸ë˜í”½ ì—†ìŒ) â€” ì´ ê²½ìš°ì—ë„ ìœ„ ì¿¼ë¦¬ëŠ” 0%ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
- ìŠ¤íŒŒì´í¬ê°€ 2%ì²˜ëŸ¼ ë³´ì´ë©´: â€œí•´ë‹¹ ì‹œì ì˜ ìµœê·¼ 5ë¶„ ì°½ì—ì„œ ì „ì²´ ìš”ì²­ 100ê±´ ì¤‘ 2ê±´ì´ 5xxì˜€ë‹¤â€ëŠ” ê°ê°ì…ë‹ˆë‹¤. ìœˆë„ìš°ê°€ ì´ë™í•˜ë¯€ë¡œ ì‹œê°„ì´ ì§€ë‚˜ë©´ ìì—°íˆ ë‚´ë ¤ê°‘ë‹ˆë‹¤.

í…ŒìŠ¤íŠ¸/ë””ë²„ê¹… íŒ
- ì¼ë¶€ëŸ¬ 5xx ë‚´ë³´ê¸°(ìˆë‹¤ë©´ `/boom` ì—”ë“œí¬ì¸íŠ¸):
```bash
for i in {1..5}; do curl -s -o /dev/null -w "%{http_code}\n" http://localhost:8000/boom; done
```
â†’ ì ê¹ ì—ëŸ¬ìœ¨ì´ >0%ë¡œ íŠ€ëŠ”ì§€ í™•ì¸.

ë¶„ì/ë¶„ëª¨ë¥¼ ë”°ë¡œ ë³´ë©° ê²€ì¦:
```
sum(rate(fastapi_request_count_total{endpoint!="/metrics", status_code=~"5.."}[5m])) 
# ë¶„ì(5xx RPS)

sum(rate(fastapi_request_count_total{endpoint!="/metrics"}[5m]))  
# ë¶„ëª¨(ì „ì²´ RPS)
```
ì‘ìš©(ì›ì¸ ë¹ ë¥´ê²Œ ì°¾ê¸°)
- ì—”ë“œí¬ì¸íŠ¸ë³„ 5xx ë¹„ìœ¨:
```
100 *
sum by (endpoint)(rate(fastapi_request_count_total{endpoint!="/metrics", status_code=~"5.."}[5m]))
/
clamp_min(sum by (endpoint)(rate(fastapi_request_count_total{endpoint!="/metrics"}[5m])), 1)
```
ë©”ì„œë“œ/ìƒíƒœë³„ 5xx RPS(ì ˆëŒ€ê°’):
```
sum by (method, status_code)(
  rate(fastapi_request_count_total{endpoint!="/metrics", status_code=~"5.."}[5m])
)
```

---
ëŒ€ì‹œë³´ë“œ 3ì¢…(ê°€ì¥ ê¸°ë³¸)
1. Health (up) : ì‚´ì•„ìˆëŠ”ì§€ ì—¬ë¶€    
2. RPS : ì´ˆë‹¹ ìš”ì²­ ìˆ˜
3. P95 Latency : 95% ìš”ì²­ì´ ì´ ì‹œê°„ë³´ë‹¤ ë¹¨ë¦¬ ì‘ë‹µí•¨

ì´ˆë³´ì í•„ìˆ˜ Grafana ì¿¼ë¦¬ 3ì¢…
![[Pasted image 20250813173754.png]]

í•„ìˆ˜ PromQL ê°œë…
![[Pasted image 20250813172015.png]]

ì¸ìŠ¤í„´ìŠ¤(í˜¸ìŠ¤íŠ¸)ë³„ CPU ì‚¬ìš©ë¥ (%)
```
100 - avg by (instance)(rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100
```

![[Pasted image 20250817195926.png]]
- `node_cpu_seconds_total{mode="idle"}`: CPUê°€ **idle** ìƒíƒœì˜€ë˜ ëˆ„ì ì‹œê°„.
- `rate(...[5m])`: **ìµœê·¼ 5ë¶„** ë™ì•ˆ idleì˜ **ë¹„ìœ¨(0~1)**.
- `avg by (instance)`: ì½”ì–´ë³„ ê°’ì„ **í˜¸ìŠ¤íŠ¸ ë‹¨ìœ„ í‰ê· **ìœ¼ë¡œ í•©ì¹¨.
- `100 - (...) * 100`: idle%ë¥¼ ë’¤ì§‘ì–´ **ì‚¬ìš©ë¥  %**ë¡œ ë³€í™˜.
    
ì¦‰, â€œìµœê·¼ 5ë¶„ ì´ë™ì°½ ê¸°ì¤€, í˜¸ìŠ¤íŠ¸ë³„ CPU ì‚¬ìš©ë¥ (%)â€ì„ ê·¸ë¦½ë‹ˆë‹¤.

ê·¸ë˜í”„ë¥¼ ì½ëŠ” ë°©ë²• (í™”ë©´ ê¸°ì¤€)
- Yì¶• ê°’ì€ â€œCPU ì‚¬ìš©ë¥  %â€. ì˜ˆ: 5ë©´ 5% ì‚¬ìš©, 55ë©´ 55% ì‚¬ìš©.
- ì™¼ìª½ì˜ ì•½ 55% â†’ ê¸‰ê° â†’ ìˆ˜ ë¶„ê°„ 3~5% â†’ ë‹¤ì‹œ ìƒìŠ¹:
    - ê·¸ êµ¬ê°„ì—ì„œ í•œë™ì•ˆ ë¶€í•˜ê°€ ì»¸ë‹¤ê°€(55%),  
        ìš”ì²­/ì‘ì—…ì´ ì¤„ì–´ë“¤ë©° ê±°ì˜ ìœ íœ´ ìƒíƒœ(3~5%)ê°€ ë˜ì—ˆê³ ,  
        ì´í›„ ë‹¤ì‹œ ë¶€í•˜ê°€ ìƒê¹€ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
- ê³„ë‹¨ì²˜ëŸ¼ ë¶€ë“œëŸ½ê²Œ ë³€í•˜ëŠ” ì´ìœ : 5ë¶„ ì´ë™ì°½`(rate[5m])`ì´ë¼ ê³¼ê±° ìƒ˜í”Œì´ ì ì  ë¹ ì ¸ë‚˜ê°€ë©° ì™„ë§Œíˆ ë³€í•©ë‹ˆë‹¤.

íŒ¨ë„ ì„¤ì •
![[Pasted image 20250817201650.png]]
 `1)` Title ë°”ê¾¸ê¸°
- ìš°ì¸¡ ì‚¬ì´ë“œë°” ìƒë‹¨ **Panel options** ì„¹ì…˜ â†’ **Title** ì…ë ¥ë€ì—  
    `CPU usage % (5m avg)` ì²˜ëŸ¼ ì ê¸° â†’ ìœ„ìª½ **Save dashboard**.
---
`2)` Unit ì„ percent(0â€“100)ë¡œ
1. ì‚¬ì´ë“œë°” ìƒë‹¨ì˜ **Search options** ì…ë ¥ì¹¸ì— `unit` ì´ë¼ê³  ì¹˜ë©´ ë°”ë¡œ í•„í„°ë¨.
2. **Standard options** ì„¹ì…˜ì´ ë³´ì´ë©´, â†’ ê·¸ ì•ˆì˜ **Unit** ë“œë¡­ë‹¤ìš´ í´ë¦­.
3. ê²€ìƒ‰ì°½ì— `percent` ì…ë ¥ â†’ **`percent (0â€“100)`** ì„ íƒ.
    
> Unitì€ ìˆ˜ì¹˜ë¥¼ **í‘œì‹œí•˜ëŠ” í˜•ì‹**ë§Œ ë°”ê¿”ì£¼ì„¸ìš”. (ì‹¤ì œ ê³„ì‚°ì—” ì˜í–¥ ì—†ìŒ)

 ì¶• ë²”ìœ„ë¥¼ 0â€“100ìœ¼ë¡œ ê³ ì •
- ê°™ì€ ì‚¬ì´ë“œë°”ì—ì„œ **Axes** ì„¹ì…˜(ë˜ëŠ” **Standard options** ì•ˆì˜ **Min / Max**) ì—´ê¸°
- **Min = 0**, **Max = 100** ì…ë ¥ â†’ ê·¸ë˜í”„ ëˆˆê¸ˆì´ í•­ìƒ 0~100ìœ¼ë¡œ ê³ ì •ë¼ì„œ í•´ì„ì´ ì‰¬ì›Œì§.
    
---
`3)` Thresholds(ê°€ì‹œì„ ) ì¶”ê°€
1. ê°™ì€ **Standard options** ì„¹ì…˜ ì•ˆì— **Thresholds** ê°€ ìˆì–´. (ì—†ìœ¼ë©´ Searchì— `thresholds`)
2. **Mode: Absolute** ìœ ì§€.
3. **Add threshold** ë‘ ë²ˆ ëˆŒëŸ¬ì„œ ê°’/ìƒ‰ì„ ì§€ì •:
    - ê°’ **70** â†’ ìƒ‰ì€ ë…¸ë‘/ì£¼í™©(ê²½ê³ )
    - ê°’ **90** â†’ ìƒ‰ì€ ë¹¨ê°•(ì‹¬ê°)
4. Time series íŒ¨ë„ì—ì„œëŠ” ê¸°ë³¸ì´ **ì„ (Line)** ë¡œ í‘œì‹œë¼. (ì„ ì´ ì•ˆ ë³´ì´ë©´ Thresholdsì—ì„œ Styleì´ _Lines_ ë¡œ ë˜ì–´ìˆëŠ”ì§€ í™•ì¸)
    
> Thresholds ëŠ” **ì‹œê°ì ì¸ ê°€ì´ë“œë¼ì¸**ì…ë‹ˆë‹¤.
> ì§„ì§œ ì•Œë¦¼ì„ ë³´ë‚´ë ¤ë©´ ì•„ë˜ â€œAlertâ€ì—ì„œ **ì•Œë¦¼ ê·œì¹™**ì„ ë”°ë¡œ ë§Œë“¤ì–´ì•¼ í•¨.

---
`4)` ìì˜í•œ ë§ˆë¬´ë¦¬ íŒ
- **Decimals**(í‘œì‹œ ì†Œìˆ˜ì ) : Standard options â†’ `0`ì´ë‚˜ `1`ë¡œ ê¹”ë”í•˜ê²Œ.
- **Legend** : ì‚¬ì´ë“œë°” **Legend** ì„¹ì…˜ì—ì„œ `{{instance}}` ê°™ì€ í…œí”Œë¦¿ìœ¼ë¡œ ë³´ê¸° ì¢‹ê²Œ.
- **Refresh** : ìƒë‹¨ ì˜¤ë¥¸ìª½ **Refresh** ì£¼ê¸°ë¥¼ 5â€“10s ë¡œ ë‘ë©´ ì‹¤ì‹œê°„ ëŠë‚Œ OK.
- ì €ì¥ì€ í•­ìƒ ìš°ìƒë‹¨ **Save dashboard**.
---
ì½”ì–´ë³„ CPU ì‚¬ìš©ë¥ (%)
```
100 - avg by (instance, cpu) (
  rate(node_cpu_seconds_total{mode="idle"}[5m])
) * 100
```

ë°˜ì‘ì„ ë” ë¹ ë¥´ê²Œ(ë¯¼ê°) ë³´ê³  ì‹¶ìœ¼ë©´
```
100 - avg by (instance) (
  irate(node_cpu_seconds_total{mode="idle"}[1m])
) * 100
```

CPU ì‚¬ìš©ë¥ (%)
```
(1 - avg by (instance)(rate(node_cpu_seconds_total{mode="idle"}[5m]))) * 100

```

ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ (%)
```
(1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100
```

ë””ìŠ¤í¬ Busy(% ëŒ€ëµ)
```
rate(node_disk_io_time_seconds_total{device=~"nvme0n1|sda"}[5m]) * 100
```

ë„¤íŠ¸ì›Œí¬ ìˆ˜ì‹ /ì†¡ì‹  ë°”ì´íŠ¸/ì´ˆ
```
sum by (instance)(rate(node_network_receive_bytes_total[5m]))
sum by (instance)(rate(node_network_transmit_bytes_total[5m]))
```
ë¼ë²¨ í•„í„°ë§ì€ `{instance="node_exporter:9100"}`ì²˜ëŸ¼ **ì‹¤ì œ ë¼ë²¨ê°’**ì„ ì¨ì•¼ í•©ë‹ˆë‹¤.  
(`host1` ê°™ì€ ê°€ìƒì˜ ê°’ì´ë©´ â€œNo dataâ€. ê°’ì€ Exploreì—ì„œ `sum by(instance)(â€¦ )`ë¡œ í™•ì¸)

---
1) ë°”ë¡œ ì¨ë¨¹ëŠ” ì¿¼ë¦¬ (Prometheus â†’ Graph íƒ­)
- ì‚´ì•„ìˆëŠ”ì§€:  
    `up`  
    (ê°’ì´ 1ì´ë©´ OK)
![[Pasted image 20250813153119.png]]

í•„ìˆ˜ ëª¨ë‹ˆí„°ë§ í•­ëª© (FastAPI / Django ê³µí†µ)
![[Pasted image 20250813153821.png]]

ğŸ“‹ ëª¨ë‹ˆí„°ë§ 3ë‹¨ê³„
1. ì‚´ì•„ìˆë‚˜? â†’ `up`  
    (0ì´ë©´ ì„œë²„ ì£½ìŒ â†’ ì„œë²„ ì¬ì‹œì‘ or ì¥ì•  ëŒ€ì‘)
2. ì •ìƒ ì‘ë‹µí•˜ë‚˜? â†’ ìš”ì²­ ìˆ˜ ëŒ€ë¹„ 500 ì—ëŸ¬ ë¹„ìœ¨ í™•ì¸
```
rate(fastapi_request_count_total{status_code="500"}[5m])
```
5ë¶„ ë™ì•ˆ ì´ˆë‹¹ ì—ëŸ¬ ê±´ìˆ˜ í™•ì¸

3. ëŠë ¤ì§€ì§„ ì•Šë‚˜? â†’ ì‘ë‹µ P95/P99
```
histogram_quantile(
  0.95,
  sum(rate(fastapi_request_latency_seconds_bucket[5m])) by (le)
)
```
(Djangoë©´ `django_http_request_duration_seconds_bucket`ë¡œ êµì²´)

---
í¬íŠ¸í´ë¦¬ì˜¤ì— ë„£ì„ â€œë”± í•µì‹¬â€ êµ¬ì„±

1. ëŒ€ì‹œë³´ë“œ 3ì¢… (ì´ë¯¸ ì„¸íŒ…í•œ íë¦„ ê·¸ëŒ€ë¡œ)
- Health: `up{job=~"fastapi|django"}`
- RPS:
    - FastAPI: `sum(rate(fastapi_request_count_total[1m]))`
    - Django: `sum(rate(django_http_requests_total_by_method_total[1m]))`
- P95 Latency:
    - FastAPI: `histogram_quantile(0.95, sum(rate(fastapi_request_latency_seconds_bucket[5m])) by (le))`
    - Django: `histogram_quantile(0.95, sum(rate(django_http_request_duration_seconds_bucket[5m])) by (le))`
    
2. **ì˜¤ë¥˜ìœ¨ íŒ¨ë„(ì„ íƒ)**
```
sum(rate(fastapi_request_count_total{status_code=~"5.."}[5m]))  / sum(rate(fastapi_request_count_total[5m]))
```
(ë‹¨ìœ„: Percent)

3. **ë¶€í•˜ ìŠ¤í¬ë¦½íŠ¸(ë°ëª¨)**
```
# FastAPI ì—”ë“œí¬ì¸íŠ¸ 200íšŒ for i in {1..200}; do curl -s -o /dev/null http://localhost:8000/; done
```
â†’ ê·¸ë˜í”„ê°€ ì¦‰ì‹œ ë³€í•˜ëŠ” ê±¸ ì‹œì—°.

---
ì œì¶œë¬¼(Deliverables) ì²´í¬ë¦¬ìŠ¤íŠ¸
- `README.md`ì— **Monitoring** ì„¹ì…˜ ì¶”ê°€
    - êµ¬ì„±ë„(â€œFastAPI/Django â†’ /metrics â†’ Prometheus â†’ Grafanaâ€) í•œ ì¥
    - ì‹¤í–‰ ë°©ë²•(ì•„ë˜ docker-compose ì˜ˆ)ê³¼ ì ‘ì† URL
    - ëŒ€ì‹œë³´ë“œ ìŠ¤í¬ë¦°ìƒ· 2~3ì¥(í‰ì‹œ, ë¶€í•˜ì‹œ, ì—ëŸ¬ì‹œ)
        
- `docker-compose.yml` (ì›í´ë¦­ ì‹¤í–‰)
- `prometheus.yml`
- Grafana Dashboard JSON(Exportí•´ì„œ `grafana/` í´ë”ì— í¬í•¨)
- ê°„ë‹¨ ë¶€í•˜ ìŠ¤í¬ë¦½íŠ¸(`scripts/warmup.sh`)

---
READMEì— ë„£ì„ ì†Œê°œ ë¬¸êµ¬(ì§§ê²Œ)
- â€œì„œë¹„ìŠ¤ ìƒíƒœ(UP), ì´ˆë‹¹ ìš”ì²­ ìˆ˜(RPS), P95 ì‘ë‹µì§€ì—°ì„ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§â€
- â€œë¶€í•˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ íŠ¸ë˜í”½ ë°œìƒ â†’ ëŒ€ì‹œë³´ë“œì—ì„œ ë³€í™” í™•ì¸â€
- â€œë°°í¬ ì „í›„ ì§€ì—°ì‹œê°„ ë¹„êµë¡œ ìµœì í™” íš¨ê³¼ ê²€ì¦â€
    
---
ë©´ì ‘ì—ì„œ ì´ë ‡ê²Œ ë§í•˜ê¸°
- â€œë¬¸ì œë¥¼ ìˆ«ìë¡œ ë³¸ë‹¤: **UP/RPS/P95**ë¥¼ í•­ìƒ í™•ì¸â€
- â€œì´ìƒ ì§•í›„(ì—ëŸ¬ìœ¨Â·ì§€ì—° ê¸‰ë“±) ë°œìƒ ì‹œ **ì›ì¸ ê°€ì„¤** ì„¸ìš°ê³  ë¡œê·¸/ì¿¼ë¦¬ë¡œ ì¶”ì â€
- â€œíŠœë‹ ì „/í›„ **ê·¸ë˜í”„ ë¹„êµ**ë¡œ ê°œì„  ì¦ë¹™â€

---
ì£¼ì˜ & íŒ
- ê°œì¸ ì •ë³´/ë¹„ë°€ í‚¤ê°€ **ë©”íŠ¸ë¦­/ìŠ¤í¬ë¦°ìƒ·**ì— ë…¸ì¶œë˜ì§€ ì•Šê²Œ
- ëŒ€ì‹œë³´ë“œ JSONì€ â€œë°ëª¨ìš©â€ìœ¼ë¡œ ê°„ë‹¨íˆ, ë³µì¡í•œ ì•ŒëŒì€ ìƒëµí•´ë„ ì¶©ë¶„
- ì‹¤í–‰ ê°€ì´ë“œì—” **3ì¤„ ìš”ì•½** ì œê³µ:
    1. `docker compose up -d`
    2. FastAPI: [http://localhost:8000](http://localhost:8000), Django: [http://localhost:8900](http://localhost:8900)
    3. Prometheus: :9090, Grafana: :3000 (admin / admin)

---
###### ì„œë²„/ì‹œìŠ¤í…œ ì§€í‘œ
| ì§€í‘œ ì¢…ë¥˜               | ì„¤ëª…                          | í™œìš© ì˜ˆì‹œ                               |
| ------------------- | --------------------------- | ----------------------------------- |
| CPU ì‚¬ìš©ë¥              | CPU ì½”ì–´ë“¤ì´ ì–¼ë§ˆë‚˜ ë°”ì˜ê²Œ ì¼í•˜ê³  ìˆëŠ”ì§€(%) | 90% ì´ìƒ ê³„ì† ìœ ì§€ë˜ë©´ CPU ì¦ì„¤Â·ìµœì í™” í•„ìš”        |
| ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰             | RAMì˜ í˜„ì¬ ì‚¬ìš©ëŸ‰ ë° ë‚¨ì€ ìš©ëŸ‰         | ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì—¬ë¶€ í™•ì¸, OOM(Out Of Memory) ë°©ì§€ |
| ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰             | SSD/HDDì˜ ì‚¬ìš©ëŸ‰ ë° ë‚¨ì€ ê³µê°„        | ë¡œê·¸, ë°ì´í„°ë² ì´ìŠ¤ ìš©ëŸ‰ ê´€ë¦¬                    |
| ë””ìŠ¤í¬ I/O             | ì´ˆë‹¹ ì½ê¸°/ì“°ê¸° ì†ë„                 | DBë‚˜ íŒŒì¼ ì„œë²„ ë³‘ëª© ì›ì¸ ë¶„ì„                  |
| ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½            | ì´ˆë‹¹ ì†¡ìˆ˜ì‹  ë°ì´í„°ëŸ‰                 | íŠ¸ë˜í”½ ê¸‰ì¦ ì‹œ DDoS íƒì§€, ë„¤íŠ¸ì›Œí¬ ìš©ëŸ‰ í™•ì¥        |
| í”„ë¡œì„¸ìŠ¤ ìˆ˜              | ì„œë²„ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ê°œìˆ˜          | ë¹„ì •ìƒì ì¸ í”„ë¡œì„¸ìŠ¤ í­ì¦ íƒì§€                    |
| ë¡œë“œ í‰ê· (Load Average) | CPUê°€ ë™ì‹œì— ì²˜ë¦¬í•˜ë ¤ëŠ” ì‘ì—… í ê¸¸ì´      | ì„œë²„ ê³¼ë¶€í•˜ ì—¬ë¶€ íŒë‹¨                        |

ì–´ë””ì— ì‚¬ìš©ë˜ë‚˜?
1. ì¥ì•  ì˜ˆë°© (Preventive Monitoring)
    - ì˜ˆ: ë””ìŠ¤í¬ ì‚¬ìš©ë¥ ì´ 90%ë¥¼ ë„˜ê¸°ë©´ ê²½ê³  ì•Œë¦¼ ë°œì†¡ â†’ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì „ ì¡°ì¹˜ ê°€ëŠ¥
    - CPU ë¶€í•˜ ê¸‰ì¦ ê°ì§€ í›„ íŠ¸ë˜í”½ ìš°íšŒë‚˜ ìŠ¤ì¼€ì¼ ì•„ì›ƒ(ì„œë²„ ì¦ì„¤) ê²°ì •
        
2. ì„±ëŠ¥ ìµœì í™” (Performance Tuning)
    - ì„œë²„ ë¦¬ì†ŒìŠ¤ê°€ ì–´ë–¤ ì‹œê°„ëŒ€ì— ê°€ì¥ ë§ì´ ì“°ì´ëŠ”ì§€ ë¶„ì„ â†’ ë¶€í•˜ ë¶„ì‚° ìŠ¤ì¼€ì¤„ë§
    - ì˜ˆ: ë§¤ì¼ ì˜¤í›„ 2ì‹œ CPU 90% â†’ ë°°ì¹˜ ì‘ì—… ì‹œê°„ ë³€ê²½
        
3. ì¥ì•  ì›ì¸ ë¶„ì„ (Troubleshooting)
    - "ì™œ ì„œë²„ê°€ ëŠë ¤ì¡Œë‚˜?" â†’ CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬, ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ëŸ‰ ë³€í™” ì¶”ì 
    - ì˜ˆ: ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê¸‰ì¦ â†’ íŠ¹ì • API ìš”ì²­ í­ë°œ
        
4. ìš©ëŸ‰ ê³„íš (Capacity Planning)
    - ë°ì´í„° ì¦ê°€ ì†ë„ì™€ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ì¶”ì„¸ë¥¼ ë¶„ì„ â†’ ì„œë²„ ì¦ì„¤ ì‹œê¸° ì˜ˆì¸¡
    - ì˜ˆ: í˜„ì¬ ì†ë„ë©´ 3ê°œì›” í›„ ë””ìŠ¤í¬ ê½‰ ì°¸ â†’ ë¯¸ë¦¬ ìŠ¤í† ë¦¬ì§€ ì¶”ê°€
